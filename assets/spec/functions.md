# 機能設計書

## 実行環境 (予定)

| No. | モジュール名               | 場所                 |
| --- | -------------------------- | -------------------- |
| 1   | フロントエンド             | Vercel               |
| 2   | バックエンド(コントラクト) | ブロックチェーン     |
| 3   | API                        | AWS (現在はローカル) |
| 4   | ストレージ                 | IPFS と S3           |

## 機能一覧表

| 機能名                   | 説明                                                                                                  |
| ------------------------ | ----------------------------------------------------------------------------------------------------- |
| Blocto ログイン 機能     | コントラクトウォレットを作成する機能                                                                  |
| トークン発行機能         | トークンを発行する機能                                                                                |
| トークン送信機能         | トークンを送金する機能                                                                                |
| トークン購入機能         | トークンを購入する機能                                                                                |
| ✨DID 登録機能           | 新規ログイン時に DID を発行し、name と紐付けてスマコンに登録する機能                                  |
| DID 関連データの登録機能 | DID と紐づく情報(VC)を IPFS に登録する機能                                                            |
| DID 関連情報表示機能     | DID と紐づく情報を表示する機能                                                                        |
| ✨ ユーザー検索機能      | DNS を元にユーザー情報を検索できる機能                                                                |
| ✨ スコアリング機能      | ユーザーとのやり取り検索・トークン送金などの活動に応じてスコアが上昇していく機能 (chainlink 使う？？) |

## 画面一覧

| 画面名                          | 概要                                                                                   |
| ------------------------------- | -------------------------------------------------------------------------------------- |
| ログイン画面                    | blocto SDK の機能を使って にログインする画面                                           |
| Home 画面                       | DID と保有している トークン・DID と紐づく情報を表示する画面                            |
| 送金画面                        | 指定した DID に対して送金する画面                                                      |
| 購入画面                        | トークンを購入する画面                                                                 |
| VC 登録画面                     | 自身の DID に紐づく VC を登録するための画面                                            |
| VC 検証画面                     | 自身の DID に紐づく VC を表示・検証するための画面                                      |
| ✨ 初期登録画面                 | 初回ログイン時に name を登録してコントラクトに登録を行う画面                           |
| ✨ ユーザー検索画面             | 指定したユーザー名の情報を取得するための検索画面                                       |
| ✨ ログインユーザー情報一覧画面 | ログインしているユーザーのアドレス・DID・NFT・トークン・VC・スコアを一覧で表示する画面 |

## 変数一覧

| コントラクト名 | 変数名       | 型                          | 内容                                                                                                              |
| -------------- | ------------ | --------------------------- | ----------------------------------------------------------------------------------------------------------------- |
| MyToken        | tokenName    | string                      | トークンの名前                                                                                                    |
| MyToken        | tokenSymbol  | string                      | トークンのシンボル                                                                                                |
| ✨MyToken      | scores       | mapping(address => uint)    | アドレスに紐づくスコアを保持するための Map                                                                        |
| ✨DNS          | isRegistered | mapping(address => bool)    | コントラクトウォレットアドレスに紐づく DID が生成されているチェックするための map                                 |
| ✨DNS          | dids         | mapping(address => string)  | DID とコントラクトウォレットのアドレスを格納する Map (アドレスから DID を求めるための map)                        |
| ✨DNS          | addrs        | mapping(string => address)  | DID とコントラクトウォレットのアドレスを格納する Map (DID からコントラクトウォレットのアドレスを求めるための map) |
| ✨DNS          | vcs          | mapping(string => [VcInfo]) | コントラクトウォレットと VC までの CID 情報 を格納する Map                                                        |
| ✨DNS          | svgPartOne   | string                      | NFT のメタデータ(画像)用の Svg データ 1                                                                           |
| ✨DNS          | svgPartTwo   | string                      | NFT のメタデータ(画像)用の Svg データ 2                                                                           |
| ✨DNS          | owner        | address                     | DNS コントラクトの owner アドレス。                                                                               |
| ✨DNS          | domains      | mapping(string => string)   | DID と name を紐づける Map                                                                                        |
| ✨DNS          | names        | mapping(unit => string)     | トークン ID と name を紐づける Map                                                                                |
|                |              |                             |                                                                                                                   |

## メソッド一覧

| コントラクト名 | メソッド名            | 内容                                                                            |
| -------------- | --------------------- | ------------------------------------------------------------------------------- |
| MyToken        | pause                 | トークンを停止するための関数                                                    |
| MyToken        | unpause               | 停止状態を解除するための関数                                                    |
| MyToken        | mint                  | トークンを発行する関数                                                          |
| MyToken        | burnToken             | トークンを償却する関数                                                          |
| MyToken        | \_beforeTokenTransfer | トークン移転用の関数                                                            |
| MyToken        | \_afterTokenTransfer  | トークン移転用の関数                                                            |
| MyToken        | \_mint                | 発行用の関数                                                                    |
| MyToken        | \_burn                | 償却用の関数                                                                    |
| ✨MyToken      | getScore              | 指定したウォレットアドレスに紐づくスコアを取得するための変数                    |
| ✨MyToken      | updateScore           | 指定したウォレットアドレスに紐づくスコアを更新するための変数                    |
| ✨DNS          | register              | DID とコントラクトウォレットのアドレス及び DID と name を紐づけるためのメソッド |
| ✨DNS          | getVcs                | DID に紐づく VC 情報一覧を取得するためのメソッド                                |
| ✨DNS          | updateVc              | DID に紐づく VC 情報を新たに登録するためのメソッド                              |
| ✨DNS          | isOwner               | Owner かどうかチェックするためのメソッド                                        |
| ✨DNS          | valid                 | name が 3 文字以上 10 文字以下であることをチェックするためのメソッド            |
|                |                       |                                                                                 |

## API 一覧

| メソッド種類 | API 名                 | 概要                                                                                  |
| ------------ | ---------------------- | ------------------------------------------------------------------------------------- |
| POST         | /api/mint              | Token を発行する API                                                                  |
| POST         | /api/burn              | Token を償却する API                                                                  |
| GET          | /api/balance           | Token の残高を取得する API                                                            |
| POST         | /api/send              | Token を送金する API                                                                  |
| POST         | /api/create            | DID を作成する API                                                                    |
| GET          | /api/resolve           | DID ドキュメントを検索する API                                                        |
| POST         | /create-payment-intent | stripe の Payment element を使うための API                                            |
| POST         | /api/registerIpfs      | VC の CID 情報を IPFS に登録する API                                                  |
| ✨ POST      | /api/getSoulData       | DID に紐づくデータ name ウォレットアドレス、NFT、VC、スコアの情報を取得するための API |
| ✨ POST      | /api/updateScore       | スコアを更新するための API                                                            |
